# GraalVM Native Image configuration for Laser Show
# This file contains the default arguments for native-image
#
# JavaFX 25/26 Compatibility Notes:
# - JavaFX must initialize at runtime (not build time)
# - All com.sun.javafx, com.sun.glass, com.sun.prism packages need runtime init
#
# GC Options (can be overridden at runtime with -XX:+UseG1GC etc):
# - Default: Serial GC (good for smaller heaps, simpler)
# - G1: Better for larger heaps, lower pause times
# - Epsilon: No GC (testing only)
#
# To use G1 GC at runtime: ./laser-show -XX:+UseG1GC

Args = \
    --no-fallback \
    --enable-preview \
    -H:+ReportExceptionStackTraces \
    -H:+AddAllCharsets \
    \
    # Clojure initialization at build time (faster startup) \
    --initialize-at-build-time=clojure \
    --initialize-at-build-time=org.slf4j \
    --initialize-at-build-time=ch.qos.logback \
    \
    # JavaFX MUST initialize at runtime for JavaFX 25/26 \
    --initialize-at-run-time=javafx \
    --initialize-at-run-time=com.sun.javafx \
    --initialize-at-run-time=com.sun.glass \
    --initialize-at-run-time=com.sun.prism \
    --initialize-at-run-time=com.sun.scenario \
    --initialize-at-run-time=com.sun.webkit \
    --initialize-at-run-time=com.sun.marlin \
    \
    # Resource inclusion \
    -H:IncludeResources="logback.xml" \
    -H:IncludeResources=".*\\.clj$" \
    -H:IncludeResources=".*\\.cljc$" \
    -H:IncludeResources=".*\\.edn$" \
    -H:IncludeResources=".*\\.css$" \
    -H:IncludeResources=".*\\.png$" \
    -H:IncludeResources=".*\\.ico$" \
    -H:IncludeResources=".*\\.icns$" \
    -H:IncludeResources="javafx/.*" \
    -H:IncludeResources="com/sun/javafx/.*" \
    \
    # Non-aggressive options (preserve more symbols/code) \
    -H:-DeleteLocalSymbols \
    -H:+PreserveFramePointer \
    \
    # G1 GC for better pause times (comment out for serial GC) \
    --gc=G1 \
    \
    # Heap configuration \
    -R:MinHeapSize=256m \
    -R:MaxHeapSize=2g \
    \
    # Build-time memory \
    -J-Xmx12g
